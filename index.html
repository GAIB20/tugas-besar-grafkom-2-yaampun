<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="./output.css" rel="stylesheet">
    <script id="vertex-shader-3d" type="x-shader/x-vertex">
        attribute vec3 aPosition;
        attribute vec3 aColor;
        attribute vec3 aTangent;
        attribute vec3 aBitangent;
        attribute vec3 aNormal;
        attribute vec2 aTexture;

        uniform mat4 uWorldViewProjection;
        uniform mat4 uWorldInverseTranspose;
        uniform vec3 uLightPos;
        uniform vec3 uViewPos;

        varying vec3 vNormal;
        varying vec3 vPosition;
        varying vec4 fragColor;
        varying vec2 vTexture;
        varying float colorFactor;
        varying mat4 viewMatrix;
        varying mat3 vTBN;
        varying vec3 ts_light_pos; 
        varying vec3 ts_view_pos;  
        varying vec3 ts_frag_pos;

        varying vec3 vViewDir;
        varying vec3 vLightDir;

        mat3 transpose(in mat3 inMatrix)
        {
            vec3 i0 = inMatrix[0];
            vec3 i1 = inMatrix[1];
            vec3 i2 = inMatrix[2];

            mat3 outMatrix = mat3(
                vec3(i0.x, i1.x, i2.x),
                vec3(i0.y, i1.y, i2.y),
                vec3(i0.z, i1.z, i2.z)
            );

            return outMatrix;
        }

        void main(void) {
            viewMatrix = uWorldViewProjection;
            gl_Position = uWorldViewProjection * vec4(aPosition, 1.0);
        
            vPosition = (uWorldInverseTranspose * vec4(aPosition, 1.0)).xyz;
            vNormal = mat3(uWorldInverseTranspose) * aNormal;
            fragColor = vec4(aColor, 1.0);
            vTexture = aTexture;

            vec3 t = normalize(mat3(uWorldInverseTranspose) * aTangent);
            vec3 b = normalize(mat3(uWorldInverseTranspose) * aBitangent);
            vec3 n = normalize(mat3(uWorldInverseTranspose) * aNormal);
            mat3 tbn = transpose(mat3(t, b, n));

            ts_frag_pos = vec3(uWorldViewProjection * vec4(aPosition, 1.0));

            vTBN = tbn;
            vec3 light_pos = vec3(0, 0, 1);
            ts_light_pos = tbn * light_pos;
            ts_view_pos = tbn * vec3(0, 0, 0);
            ts_frag_pos = tbn * ts_frag_pos;
            
            vec4 worldPos = uWorldViewProjection * vec4(aPosition, 1.0);
            vViewDir = uViewPos - worldPos.xyz;
            vLightDir = uLightPos - worldPos.xyz;
        }
    </script>
    <script id="fragment-shader-3d" type="x-shader/x-fragment">
        precision mediump float;

        varying vec3 vNormal;
        varying vec3 vViewDir;
        varying vec3 vLightDir;

        uniform vec3 uAmbientColor;
        uniform vec3 uDiffuseColor;
        uniform vec3 uSpecularColor;
        uniform float uShininess;
        uniform vec3 uLightPos;

        uniform vec3 uReverseLightDirection;
        uniform vec4 uColor;

        void main(void) {
            vec3 normal = normalize(vNormal);
            vec3 viewDir = normalize(vViewDir);
            vec3 lightDir = normalize(vLightDir);
            
            // Lambertian (diffuse) reflection
            float diffuseFactor = max(dot(normal, lightDir), 0.0);
            vec3 diffuse = uDiffuseColor * diffuseFactor;

            // Specular reflection
            vec3 reflectDir = reflect(-lightDir, normal);
            float specularFactor = pow(max(dot(viewDir, reflectDir), 0.0), uShininess);
            vec3 specular = uSpecularColor * specularFactor;

            // Ambient reflection
            vec3 ambient = uAmbientColor;

            vec3 finalColor = (ambient + diffuse + specular) * uColor.rgb;

            gl_FragColor = vec4(finalColor, 1.0);
        }
    </script>
    
    <script src="https://webglfundamentals.org/webgl/resources/webgl-utils.js"></script>
    <script src="https://webglfundamentals.org/webgl/resources/webgl-lessons-ui.js"></script>
    <script type="module" src="src/index.js"></script>
    <script type="module" src="src/handler/eventHandler.js"></script>

</head>
<body class="h-screen w-screen px-5 flex flex-col">
    <div class="flex flex-row max-w-full max-h-screen overflow-hidden">

        <!-- left side -->
        <div class="grow max-h-full overflow-auto">
            <div>
                <p class="sub">Graph</p>
                <div class="divider"></div>

                <div class="max-h-[40vh] overflow-auto " id="component-container">
                </div>
            </div>

            <div>
                <p class="sub">Camera</p>
                <div class="divider"></div>
                <div class="flex flex-row gap-5">

                
                    <div class="flex flex-col">
                        <p class="font-bold">Look At</p>
                        <div class="flex flex-col">
                            <label for="camera-roll-slider">Roll (φ):</label>
                            <input type="range" min="-89" max="89" value="0" id="camera-roll-slider"/>
                            <a id="camera-roll-slider-value">0</a>
                        </div>
                        <div class="flex flex-col">
                            <label for="camera-pitch-slider">Pitch (θ):</label>
                            <input type="range" min="-180" max="180" value="0" id="camera-pitch-slider"/>
                            <a id="camera-pitch-slider-value">0</a>
                        </div>
                        <!-- <div class="flex flex-row gap-5">
                            <label for="camera-z-slider">Z:</label>
                            <input type="range" min="-10" max="10" value="0" id="camera-z-slider"/>
                        </div> -->
                    </div>
                    <div class="flex flex-col">
                        <p class="font-bold">Perspective Settings</p>
                        <label for="camera-radius-slider">Radius</label>
                        <div class="flex flex-col">
                            <input type="range" min="-100" max="100" value="50" id="camera-radius-slider"/>
                            <a id="camera-radius-slider-value">5</a>
                        </div>
                        <p class="font-bold">Oblique Angle</p>
                        <label for="camera-theta-slider">θ</label>
                        <div class="flex flex-col">
                            <input type="range" min="5" max="175" value="90" id="camera-theta-slider"/>
                            <a id="camera-theta-slider-value">90</a>
                        </div>
                        <label for="camera-phi-slider">φ</label>
                        <div class="flex flex-col">
                            <input type="range" min="5" max="175" value="90" id="camera-phi-slider"/>
                            <a id="camera-phi-slider-value">90</a>
                        </div>


                        <button class="btn mt-2">Default View</button>
                    </div>
                </div>
            </div>

            <div>
                <p class="sub">Light</p>
                <div class="divider"></div>

                <div class="flex flex-row gap-5">
                    
                    <div class="flex flex-col grow">

                        <p>Translation</p>
                        <div class="flex flex-col gap-2">
                            <div class="flex flex-row">
                                <label for="light-x-slider">X:</label>
                                <input type="range" min="-10" max="10" value="0" id="light-x-slider"/>
                            </div>
                            <div class="flex flex-row">
                                <label for="light-y-slider">Y:</label>
                                <input type="range" min="-10" max="10" value="0" id="light-y-slider"/>
                            </div>
                            <div class="flex flex-row">
                                <label for="light-z-slider">Z:</label>
                                <input type="range" min="-10" max="10" value="0" id="light-z-slider"/>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex flex-row gap-5">

                    
                    
                    <!-- directional -->
                    <div>

                    </div>

                </div>
            </div>
        </div>


        <!-- canvas -->
        <div class="grow px-5 flex">
            <div class="w-full items-center flex flex-col">
                <p class="text-3xl font-bold mb-5">3D MODEL WEBGL</p>
                <canvas id="gl-canvas" width="620" height="620" class="border-dashed border-2 border-indigo-600"></canvas>
            </div>
        </div>
        

        <!-- right side -->
        <div class="grow max-h-full overflow-auto pb-20">
            <div>
                <p class="sub">Model & Projection</p>
                <div class="divider"></div>
                
                <div class="flex flex-row gap-5 mb-2">

                
                    <div class="flex flex-row gap-5 items-center">
                        <label for="model-selection">Model</label>
                        <select class="border-2 border-slate rounded-md" name="model-selection" id="model-selection">
                            <!-- <option value="0">Pig</option>
                            <option value="1">Hollow thingy</option> -->
                        </select>
                    </div>

                    <div class="flex flex-row gap-5">
                        <button class="btn">Save</button>
                        <button class="btn">Load</button>
                    </div>
                </div>

                <div class="flex flex-row space-x-5">
                    <p>Projection</p>
                    <div class="flex flex-row items-center gap-5 justify-center">
                        <div class="flex flex-row justify-center space-x-1">
                            <input type="radio" name="projection" id="orthographic">
                            <label for="orthographic">Orthographic</label>
                        </div>
                        <div class="flex flex-row justify-center space-x-1">
                            <input type="radio" name="projection" id="oblique">
                            <label for="oblique">Oblique</label>
                        </div>
                        <div class="flex flex-row justify-center space-x-1">
                            <input type="radio" name="projection" id="perspective">
                            <label for="perspective">Perspective</label>
                        </div>
                    </div>

                </div>
            </div>

            <div>
                <p class="sub">Transformation</p>
                <div class="divider"></div>
                <div>
                    <div>
                        <p>Rotation</p>
                        <div class="flex flex-row gap-5">
                            <div class="flex flex-col">
                                <label for="rotation-x-slider">X</label>
                                <input type="range" min="-180" max="180" value="0" id="rotation-x-slider"/>
                                <label id="rotation-x-slider-value">0</label>
                            </div>
                            <div class="flex flex-col">
                                <label for="rotation-y-slider">Y</label>
                                <input type="range" min="-180" max="180" value="0" id="rotation-y-slider"/>
                                <label id="rotation-y-slider-value">0</label>
                            </div>
                            <div class="flex flex-col">
                                <label for="rotation-z-slider">Z</label>
                                <input type="range" min="-180" max="180" value="0" id="rotation-z-slider"/>
                                <label id="rotation-z-slider-value">0</label>
                            </div>
                        </div>
                    </div>
                    <div>
                        <p>Translation</p>
                        <div class="flex flex-row gap-5">
                            <div class="flex flex-col">
                                <label for="translation-x-slider">X</label>
                                <input type="range" min="-100" max="100" value="0" id="translation-x-slider"/>
                                <label id="translation-x-slider-value">0</label>
                            </div>
                            <div class="flex flex-col">
                                <label for="translation-y-slider">Y</label>
                                <input type="range" min="-100" max="100" value="0" id="translation-y-slider"/>
                                <label id="translation-y-slider-value">0</label>
                            </div>
                            <div class="flex flex-col">
                                <label for="translation-z-slider">Z</label>
                                <input type="range" min="-100" max="100" value="0" id="translation-z-slider"/>
                                <label id="translation-z-slider-value">0</label>
                            </div>
                        </div>
                    </div>
                    <div>
                        <p>Scalation</p>
                        <div class="flex flex-row gap-5">
                            <div class="flex flex-col">
                                <label for="scalation-x-slider">X</label>
                                <input type="range" min="1" max="100" value="10" id="scalation-x-slider"/>
                                <label id="scalation-x-slider-value">1</label>
                            </div>
                            <div class="flex flex-col">
                                <label for="scalation-y-slider">Y</label>
                                <input type="range" min="1" max="100" value="10" id="scalation-y-slider"/>
                                <label id="scalation-y-slider-value">1</label>
                            </div>
                            <div class="flex flex-col">
                                <label for="scalation-z-slider">Z</label>
                                <input type="range" min="1" max="100" value="10" id="scalation-z-slider"/>
                                <label id="scalation-z-slider-value">1</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <p class="sub">Material</p>
                <div class="divider"></div>

                <div class="flex flex-col gap-3">
                    <div>
                        <div class="flex flex-row gap-4">

                            <div class="flex flex-row gap-5 items-center">
                                <label for="mapping-selection">Texture Mapping</label>
                                <select class="border-2 border-slate rounded-md" name="mapping-selection" id="mapping-selection">
                                    <option value="0">None</option>
                                    <option value="1">Texture</option>
                                    <option value="2">Environment</option>
                                    <option value="3">Bump</option>
                                </select>
                            </div>
                            <div class="flex flex-row gap-5 items-center">
                                <label for="shading-selection">Shading</label>
                                <select class="border-2 border-slate rounded-md" name="shading-selection" id="shading-selection">
                                    <option value="0">Off</option>
                                    <option value="1">On</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex flex-row">

                    
                        <div class="grow">
                            <p class="font-bold">Basic</p>
                            <div class="flex flex-col">
                                <p>Ambient Color</p>
                                <div>
                                    <div class="flex flex-row">
                                        <label for="red-slider">R:</label>
                                        <input type="range" min="0" max="1" value="1" step="0.01" id="red-slider"/>
                                    </div>
                                    <div class="flex flex-row">
                                        <label for="green-slider">G:</label>
                                        <input type="range" min="0" max="1" value="1" step="0.01" id="green-slider"/>
                                    </div>
                                    <div class="flex flex-row">
                                        <label for="blue-slider">B:</label>
                                        <input type="range" min="0" max="1" value="1" step="0.01" id="blue-slider"/>
                                    </div>
                                </div>
        
                            </div>
                        </div>

                        <div class="grow">
                            <p class="font-bold">Phong</p>
                            <div>
                                <div class="flex flex-row items-center gap-3">
                                    <label for="shiness-slider">Shininess</label>
                                    <input type="range" min="0.5" max="100" value="0" id="shininess-slider">
                                </div>
                                <div class="flex flex-col ">
                                    <div class="flex flex-col">
                                        <label for="">Specular</label>
                                        <div class="flex flex-row gap-2">
                                            <input type="color">
                                            <input type="range" min="0" max="1" value="0" step="0.1" id="specular-slider">
                                        </div>
                                    </div>
                                    <div class="flex flex-col">
                                        <label for="">Diffuse</label>
                                        <div class="flex flex-row gap-2">
                                            <input type="color">
                                            <input type="range" min="0" max="1" value="0" step="0.1" id="diffuse-slider">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <p class="sub ">Animation & Frame</p>
                <div class="divider"></div>

                <div class="flex flex-row gap-5">
                    <button class="btn" id="play-animation">Play</button>
                    <button class="btn" id="pause-continue-animation">Pause</button>
                    <button class="btn" id="auto-animation">Auto</button>
                    <button class="btn" id="reverse-animation">Reverse</button>
                </div>

                <p class="mt-5">Frame</p>
                <div class="flex flex-row gap-5">
                    <button class="btn">Next</button>
                    <button class="btn">Prev</button>
                    <button class="btn">First</button>
                    <button class="btn">Last</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="src/structs/boxModel.js"></script>
<script src="src/utils/webgl.js"></script>
<script src="src/utils/helper.js"></script>
<script src="src/structs/math/Transform.js"></script>
</html>